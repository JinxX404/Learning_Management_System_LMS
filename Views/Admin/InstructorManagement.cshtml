@{
    ViewData["Title"] = "Instructor Management";
    Layout = "_AdminLayout";
    ViewData["AdminActive"] = "instructors";
}

@section Styles {
    <link rel="stylesheet" href="~/css/pages/instructor-manegment_admin.css">
}

  <main class="flex-grow-1 p-4">
    <div class="container-xxl mx-auto">
      @if (TempData["Error"] != null)
      {
          <div class="alert alert-danger alert-dismissible fade show mt-4" role="alert">
              <div class="d-flex align-items-center">
                  <span class="material-symbols-outlined me-2">error</span>
                  <div>@TempData["Error"]</div>
              </div>
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
      }
        <div class="d-flex flex-wrap justify-content-between align-items-center gap-3 mb-5 mt-4">
            <h1 class="h2 fw-bolder text-body">Instructor Management</h1>
            <a class="btn btn-primary d-inline-flex align-items-center justify-content-center gap-2 rounded-3 fw-bold fs-sm px-4" style="min-width: 84px; height: 2.5rem;" asp-action="CreateInstructor" role="button">
                <span class="material-symbols-outlined">add</span>
                <span>Add New Instructor</span>
            </a>
        </div>

        <form asp-action="Instructors" method="get" class="row g-4">
          <div class="col-lg-6">
            <label class="w-100">
              <div class="input-group rounded-3" style="height: 2.5rem;">
                <span class="input-group-text bg-body-secondary border-0" id="search-addon">
                  <span class="material-symbols-outlined text-secondary">search</span>
                </span>
                <input class="form-control bg-body-secondary border-0 fs-sm" placeholder="Search by name or email..." type="text" name="searchString" value="@ViewBag.SearchString" aria-label="Search" aria-describedby="search-addon" />
                <button class="btn btn-outline-secondary border-0" type="submit">Search</button>
              </div>
            </label>
          </div>
          <div class="col-md-6 col-lg-3">
            <select name="status" class="form-select border-0 bg-body-secondary rounded-3 fs-sm fw-medium h-100" onchange="this.form.submit()">
                <option value="All" selected="@(ViewBag.CurrentStatus == "All" || ViewBag.CurrentStatus == null)">Status: All</option>
                <option value="Active" selected="@(ViewBag.CurrentStatus == "Active")">Status: Active</option>
                <option value="Inactive" selected="@(ViewBag.CurrentStatus == "Inactive")">Status: Inactive</option>
            </select>
          </div>
          <div class="col-md-6 col-lg-3">
            <select name="department" class="form-select border-0 bg-body-secondary rounded-3 fs-sm fw-medium h-100" onchange="this.form.submit()">
                <option value="All" selected="@(ViewBag.CurrentDepartment == "All" || ViewBag.CurrentDepartment == null)">Department: All</option>
                @if (ViewBag.Departments != null)
                {
                    foreach (var dept in ViewBag.Departments)
                    {
                        <option value="@dept" selected="@(ViewBag.CurrentDepartment == dept)">@dept</option>
                    }
                }
            </select>
          </div>
        </form>
      </div>
      
      <div class="card bg-body-tertiary border rounded-4 overflow-hidden">
        <div class="table-responsive">
          <table class="table w-100 fs-sm text-start align-middle mb-0">
            <thead>
              <tr>
                <th class="px-4 py-3" scope="col">Instructor Name</th>
                <th class="px-4 py-3" scope="col">Email</th>
                <th class="px-4 py-3" scope="col">Department</th>
                <th class="px-4 py-3" scope="col">Courses</th>
                <th class="px-4 py-3" scope="col">Status</th>
                <th class="px-4 py-3 text-center" scope="col">Actions</th>
              </tr>
            </thead>
            <tbody>
              @if (ViewBag.Instructors != null)
              {
                  foreach (var instructor in ViewBag.Instructors)
                  {
                      <tr class="border-top">
                        <td class="px-4 py-3 text-nowrap">
                          <div class="d-flex align-items-center gap-3">
                            <div class="rounded-circle d-flex align-items-center justify-content-center bg-info-subtle text-info fw-bold" style="width: 2.5rem; height: 2.5rem;">
                                @{
                                    var firstInitial = !string.IsNullOrEmpty(instructor.FirstName) ? instructor.FirstName.Substring(0,1) : "?";
                                    var lastInitial = !string.IsNullOrEmpty(instructor.LastName) ? instructor.LastName.Substring(0,1) : "?";
                                }
                                @firstInitial@lastInitial
                            </div>
                            <div>
                              <div class="fw-medium text-body">@instructor.FirstName @instructor.LastName</div>
                              <div class="fs-xs text-secondary">ID: @instructor.UserId</div>
                            </div>
                          </div>
                        </td>
                        <td class="px-4 py-3 text-body">@instructor.Email</td>
                        <td class="px-4 py-3 text-body">
                            @(instructor.Institution != null ? instructor.Institution.Name : "N/A")
                        </td>
                        <td class="px-4 py-3 text-body">
                            @* We would need to load course count, for now placeholder or 0 *@
                            0
                        </td>
                        <td class="px-4 py-3">
                          @if (instructor.IsActive)
                          {
                              <span class="badge d-inline-flex align-items-center rounded-pill fs-xs fw-medium bg-success-subtle text-success-emphasis px-3 py-1">Active</span>
                          }
                          else
                          {
                              <span class="badge d-inline-flex align-items-center rounded-pill fs-xs fw-medium bg-secondary-subtle text-secondary-emphasis px-3 py-1">Inactive</span>
                          }
                        </td>
                        <td class="px-4 py-3 text-center">
                          <div class="d-flex align-items-center justify-content-center gap-2">
                            <a asp-action="EditUser" asp-route-id="@instructor.UserId" class="btn btn-icon-table text-body"><span class="material-symbols-outlined">edit</span></a>
                            <form asp-action="DeleteUser" method="post" onsubmit="return confirm('Are you sure?');" style="display:inline;">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="id" value="@instructor.UserId" />
                                <button type="submit" class="btn btn-icon-table text-danger"><span class="material-symbols-outlined">delete</span></button>
                            </form>
                          </div>
                        </td>
                      </tr>
                  }
              }
            </tbody>
          </table>
        </div>
        <div class="p-4 border-top">
          <span class="fs-sm fw-normal text-secondary">Showing <span class="fw-semibold text-body">@((ViewBag.Instructors as IEnumerable<dynamic>)?.Count() ?? 0)</span> results</span>
        </div>
      </div>
    </div>
    </div>
  </main>

@section Scripts {
    <script>
    const themeToggleBtn = document.getElementById('theme-toggle');
    const htmlElement = document.documentElement;

    themeToggleBtn?.addEventListener('click', function() {
      const currentTheme = htmlElement.getAttribute('data-bs-theme');
      if (currentTheme === 'dark') {
        htmlElement.setAttribute('data-bs-theme', 'light');
      } else {
        htmlElement.setAttribute('data-bs-theme', 'dark');
      }
    });
    </script>
}
