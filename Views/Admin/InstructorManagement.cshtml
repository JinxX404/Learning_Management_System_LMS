@{
    ViewData["Title"] = "Instructor Management";
    Layout = "_Layout";
    ViewData["AdminActive"] = "instructors";
}

@section Styles {
    <link rel="stylesheet" href="~/css/pages/instructor-manegment_admin.css">
}

<div class="d-flex min-vh-100">
  @await Html.PartialAsync("_AdminSidebar")
  
  <main class="flex-grow-1 p-4">
    <div class="container-xxl mx-auto">
        <div class="d-flex flex-wrap justify-content-between align-items-center gap-3 mb-5 mt-4">
            <h1 class="h2 fw-bolder text-body">Instructor Management</h1>
            <a class="btn btn-primary d-inline-flex align-items-center justify-content-center gap-2 rounded-3 fw-bold fs-sm px-4" style="min-width: 84px; height: 2.5rem;" asp-action="CreateInstructor" role="button">
                <span class="material-symbols-outlined">add</span>
                <span>Add New Instructor</span>
            </a>
        </div>

        <div class="row g-4">
          <div class="col-lg-6">
            <label class="w-100">
              <div class="input-group rounded-3" style="height: 2.5rem;">
                <span class="input-group-text bg-body-secondary border-0" id="search-addon">
                  <span class="material-symbols-outlined text-secondary">search</span>
                </span>
                <input class="form-control bg-body-secondary border-0 fs-sm" placeholder="Search by name or email..." type="text" aria-label="Search" aria-describedby="search-addon" />
              </div>
            </label>
          </div>
          <div class="col-md-6 col-lg-3">
            <button class="btn btn-filter d-flex align-items-center justify-content-between w-100 rounded-3 fs-sm fw-medium" style="height: 2.5rem;">
              <span>Status: All</span>
              <span class="material-symbols-outlined text-secondary fs-5">expand_more</span>
            </button>
          </div>
          <div class="col-md-6 col-lg-3">
            <button class="btn btn-filter d-flex align-items-center justify-content-between w-100 rounded-3 fs-sm fw-medium" style="height: 2.5rem;">
              <span>Department: All</span>
              <span class="material-symbols-outlined text-secondary fs-5">expand_more</span>
            </button>
          </div>
        </div>
      </div>
      
      <div class="card bg-body-tertiary border rounded-4 overflow-hidden">
        <div class="table-responsive">
          <table class="table w-100 fs-sm text-start align-middle mb-0">
            <thead>
              <tr>
                <th class="p-4" scope="col">
                  <input class="form-check-input bg-body-secondary" type="checkbox" />
                </th>
                <th class="px-4 py-3" scope="col">Instructor Name</th>
                <th class="px-4 py-3" scope="col">Email</th>
                <th class="px-4 py-3" scope="col">Department</th>
                <th class="px-4 py-3" scope="col">Courses</th>
                <th class="px-4 py-3" scope="col">Status</th>
                <th class="px-4 py-3 text-center" scope="col">Actions</th>
              </tr>
            </thead>
            <tbody>
              @if (ViewBag.Instructors != null)
              {
                  foreach (var instructor in ViewBag.Instructors)
                  {
                      <tr class="border-top">
                        <td class="w-4 p-4">
                          <input class="form-check-input" type="checkbox" value="@instructor.UserId" />
                        </td>
                        <td class="px-4 py-3 text-nowrap">
                          <div class="d-flex align-items-center gap-3">
                            <div class="rounded-circle d-flex align-items-center justify-content-center bg-info-subtle text-info fw-bold" style="width: 2.5rem; height: 2.5rem;">
                                @{
                                    var firstInitial = !string.IsNullOrEmpty(instructor.FirstName) ? instructor.FirstName.Substring(0,1) : "?";
                                    var lastInitial = !string.IsNullOrEmpty(instructor.LastName) ? instructor.LastName.Substring(0,1) : "?";
                                }
                                @firstInitial@lastInitial
                            </div>
                            <div>
                              <div class="fw-medium text-body">@instructor.FirstName @instructor.LastName</div>
                              <div class="fs-xs text-secondary">ID: @instructor.UserId</div>
                            </div>
                          </div>
                        </td>
                        <td class="px-4 py-3 text-body">@instructor.Email</td>
                        <td class="px-4 py-3 text-body">
                            @(instructor.Institution != null ? instructor.Institution.Name : "N/A")
                        </td>
                        <td class="px-4 py-3 text-body">
                            @* We would need to load course count, for now placeholder or 0 *@
                            0
                        </td>
                        <td class="px-4 py-3">
                          @if (instructor.IsActive)
                          {
                              <span class="badge d-inline-flex align-items-center rounded-pill fs-xs fw-medium bg-success-subtle text-success-emphasis px-3 py-1">Active</span>
                          }
                          else
                          {
                              <span class="badge d-inline-flex align-items-center rounded-pill fs-xs fw-medium bg-secondary-subtle text-secondary-emphasis px-3 py-1">Inactive</span>
                          }
                        </td>
                        <td class="px-4 py-3 text-center">
                          <div class="d-flex align-items-center justify-content-center gap-2">
                            <a asp-action="EditUser" asp-route-id="@instructor.UserId" class="btn btn-icon-table text-body"><span class="material-symbols-outlined">edit</span></a>
                            <form asp-action="DeleteUser" method="post" onsubmit="return confirm('Are you sure?');" style="display:inline;">
                                <input type="hidden" name="id" value="@instructor.UserId" />
                                <button type="submit" class="btn btn-icon-table text-danger"><span class="material-symbols-outlined">delete</span></button>
                            </form>
                          </div>
                        </td>
                      </tr>
                  }
              }
            </tbody>
          </table>
        </div>
        <nav aria-label="Table navigation" class="d-flex align-items-center justify-content-between p-4 border-top">
          <span class="fs-sm fw-normal text-secondary">Showing <span class="fw-semibold text-body">1-4</span> of <span class="fw-semibold text-body">100</span></span>
          <ul class="pagination pagination-sm mb-0">
            <li class="page-item"><a class="page-link rounded-start-2" href="#">Previous</a></li>
            <li class="page-item"><a class="page-link" href="#">1</a></li>
            <li class="page-item active" aria-current="page"><a class="page-link" href="#">2</a></li>
            <li class="page-item"><a class="page-link" href="#">3</a></li>
            <li class="page-item"><a class="page-link rounded-end-2" href="#">Next</a></li>
          </ul>
        </nav>
      </div>
    </div>
    </div>
  </main>
</div>

@section Scripts {
    <script>
    const themeToggleBtn = document.getElementById('theme-toggle');
    const htmlElement = document.documentElement;

    themeToggleBtn?.addEventListener('click', function() {
      const currentTheme = htmlElement.getAttribute('data-bs-theme');
      if (currentTheme === 'dark') {
        htmlElement.setAttribute('data-bs-theme', 'light');
      } else {
        htmlElement.setAttribute('data-bs-theme', 'dark');
      }
    });
    </script>
}
